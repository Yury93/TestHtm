<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | BlockBreaker</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <link rel="stylesheet" href="TemplateData/preloader.css">
</head>

<body>

    <!-- Прелоадер -->
    <div class="preloader">
        <div class="preloader__bar-container">
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
        </div>
        <div class="wrapper">
            <h1 class="title">Welcome To <span id="word">CopArcadia!</span></h1>
            <img src="TemplateData/girl.png" alt="hero" class="hero-img">

            <div class="loader">
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
            </div>
        </div>
        <!-- <img src="img/Bitcoin-1.svg" alt="crypto-coin" class="crypto-img">
        <img src="img/Etherium-1.svg" alt="crypto-coin" class="crypto-img">
        <img src="img/Monero-2.svg" alt="crypto-coin" class="crypto-img">
        <img src="img/LiteCoin-3.svg" alt="crypto-coin" class="crypto-img">
        <img src="img/Etherium-3.svg" alt="crypto-coin" class="crypto-img"> -->
    </div>
    <!-- Unity канвас -->
    <div id="unity-container" style="position: absolute; width: 100%; height: 100%; left: 0%; top: 0%;">
        <canvas id="unity-canvas" style="position: absolute; width: 100%; height: 100%;"></canvas>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        // Устанавливаем начальные параметры для прелоадера и канваса
        const tloader = gsap.timeline();
        var preloader = document.querySelector(".preloader");

        // Основная анимация для прелоадера
        tloader
            .set('.wrapper', { opacity: 0 }) // Прелоадер также скрыт
            .to('.wrapper', { opacity: 1, duration: 0.5 }) // Плавное появление прелоадера
            .to('.preloader__bar', {
                height: '110vh', // Появление полосок прелоадера
                duration: 0.5,
                stagger: 0.2
            })
            .to('.wrapper', { opacity: 0 })
            .to('.preloader__bar', {
                height: '110vh', // Убираем полоски прелоадера вверх
                duration: 1,
                stagger: 0.05,
                borderBottomLeftRadius: 250,
                borderBottomRightRadius: 250,
                opacity: 0
            })
            .call(() => {
                // После завершения анимации полосок, запускаем появление канваса
                gsap.to('#unity-container', { opacity: 1, duration: 1.5 });
                preloader.style.display = 'none'
            });


        // Функция для загрузки Unity и плавного появления канваса
        function startUnityLoading() {
            var container = document.querySelector("#unity-container");
            var canvas = document.querySelector("#unity-canvas");
            container.style.opacity = '0';

            var buildUrl = "Build";
            var loaderUrl = buildUrl + "/BlockBreaker.loader.js";
            var config = {
                dataUrl: buildUrl + "/BlockBreaker.data.unityweb",
                frameworkUrl: buildUrl + "/BlockBreaker.framework.js.unityweb",
                codeUrl: buildUrl + "/BlockBreaker.wasm.unityweb",
                streamingAssetsUrl: "StreamingAssets",
                companyName: "DefaultCompany",
                productName: "BlockBreaker",
                productVersion: "1.0",
            };

            if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                var meta = document.createElement('meta');
                meta.name = 'viewport';
                meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
                document.getElementsByTagName('head')[0].appendChild(meta);
                container.className = "unity-mobile";
                canvas.className = "unity-mobile";
            } else {
                canvas.style.width = "100%";
                canvas.style.height = "100%";
            }

            // Загружаем Unity WebGL
            var script = document.createElement("script");
            script.src = loaderUrl;
            script.onload = () => {
                createUnityInstance(canvas, config, (progress) => {
                    console.log(`Progress: ${progress * 100}%`);
                }).then((unityInstance) => {
                    // Прелоадер скроется после загрузки Unity, как только канвас будет полностью видим
                }).catch((message) => {
                    alert(message);
                });
            };
            document.body.appendChild(script);
        }

        startUnityLoading();
    </script>

</body>

</html>