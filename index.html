<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | BlockBreaker</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <link rel="stylesheet" href="TemplateData/preloader.css">
</head>

<body>

    <!-- Прелоадер -->
    <div class="preloader">
        <div class="preloader__bar-container">
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
            <div class="preloader__bar"></div>
        </div>
        <div class="wrapper">
            <h1 class="title">Welcome To <span id="word">CopArcadia!</span></h1>
            <img src="TemplateData/anime-boy3.png" alt="hero" class="hero-img">

            <div class="loader">
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
                <div class="box"></div>
            </div>
        </div>
        <!-- <img src="img/Bitcoin-1.svg" alt="crypto-coin" class="crypto-img">
        <img src="img/Etherium-1.svg" alt="crypto-coin" class="crypto-img">
        <img src="img/Monero-2.svg" alt="crypto-coin" class="crypto-img">
        <img src="img/LiteCoin-3.svg" alt="crypto-coin" class="crypto-img">
        <img src="img/Etherium-3.svg" alt="crypto-coin" class="crypto-img"> -->
    </div>
    <!-- Unity канвас -->
    <div id="unity-container" style="position: absolute; width: 100%; height: 100%; left: 0%; top: 0%;">
        <canvas id="unity-canvas" style="position: absolute; width: 100%; height: 100%;"></canvas>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        // Устанавливаем начальные параметры для прелоадера и канваса
        const tloader = gsap.timeline();
        var preloader = document.querySelector(".preloader");

        // Основная анимация для прелоадера
        tloader
            .set('.wrapper', { opacity: 0 }) // Прелоадер скрыт по умолчанию
            .to('.wrapper', { opacity: 1, duration: 0.5 }) // Плавное появление прелоадера
            .to('.preloader__bar', {
                height: '110vh', // Появление полосок прелоадера
                duration: 0.5,
                stagger: 0.2
            });

        // Функция для загрузки Unity
        function startUnityLoading() {
            var container = document.querySelector("#unity-container");
            var canvas = document.querySelector("#unity-canvas");
            var preloader = document.querySelector(".preloader");
            container.style.opacity = '0';

            var buildUrl = "Build";
            var loaderUrl = buildUrl + "/BlockBreaker.loader.js";
            var config = {
                dataUrl: buildUrl + "/BlockBreaker.data.unityweb",
                frameworkUrl: buildUrl + "/BlockBreaker.framework.js.unityweb",
                codeUrl: buildUrl + "/BlockBreaker.wasm.unityweb",
                streamingAssetsUrl: "StreamingAssets",
                companyName: "DefaultCompany",
                productName: "BlockBreaker",
                productVersion: "1.0",
            };

            // Загружаем Unity WebGL
            var script = document.createElement("script");
            script.src = loaderUrl;
            script.onload = () => {
                createUnityInstance(canvas, config, (progress) => {
                    console.log(`Progress: ${progress * 100}%`);
                }).then((unityInstance) => {
                    // Скрываем wrapper перед началом анимации preloader__bar
                    gsap.to('.wrapper', {
                        opacity: 0,
                        duration: 0.5,
                        onComplete: () => {
                            // Как только wrapper скрыт, запускаем оставшуюся анимацию полосок
                            gsap.to('.preloader__bar', {
                                height: '110vh', // Убираем полоски прелоадера вверх
                                duration: 1,
                                stagger: 0.05,
                                borderBottomLeftRadius: 250,
                                borderBottomRightRadius: 250,
                                opacity: 0,
                                onComplete: () => {
                                    // После завершения анимации полосок, запускаем появление канваса
                                    preloader.style.display = 'none';
                                    gsap.to('#unity-container', { opacity: 1, duration: 1 });
                                }
                            });
                        }
                    });
                }).catch((message) => {
                    alert(message);
                });
            };

            document.body.appendChild(script);
        }

        // Запуск загрузки Unity и анимации прелоадера
        startUnityLoading();
    </script>

</body>

</html>